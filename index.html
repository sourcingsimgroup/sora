<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#2563eb" id="themeColor" />
  <title>SORA • Sourcing Referral Agent</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Default (will be overwritten by JS themes) */
      --brand:#2563eb; /* primary */
      --brand2:#7c3aed; /* gradient end */
      --ink:#0f172a;   /* text */
      --sub:#475569;   /* subtext */
      --bg:#f8fafc;    /* page bg */
      --card:#ffffff;  /* card bg */
      --line:#e2e8f0;  /* borders */
      --ok:#16a34a;    /* success */
      --warn:#d97706;  /* warn */
      --danger:#dc2626;/* error */
      --ring: 0 0 0 3px color-mix(in oklab, var(--brand) 20%, transparent);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap{max-width:720px;margin:0 auto;padding:16px 16px 24px 16px}
    .hero{
      position:sticky; top:0; z-index:5; padding:28px 16px 20px 16px;
      background: linear-gradient(135deg,var(--brand),var(--brand2));
      color:white; border-bottom-left-radius:16px; border-bottom-right-radius:16px;
      box-shadow:0 6px 30px rgb(0 0 0 / .12);
    }
    .hero .title{display:flex; align-items:center; gap:10px;}
    .app-icon{width:42px; height:42px; display:grid; place-items:center; border-radius:12px; background:rgba(255,255,255,.15); backdrop-filter: blur(2px);}
    .app-icon svg{width:26px; height:26px; fill:#fff}
    h1{font-size:28px; line-height:1.1; margin:0}
    .sub{opacity:.95; font-weight:500; letter-spacing:.2px;}
    .toolbar{display:flex; gap:10px; align-items:center; margin-top:14px;}
    .chip{padding:8px 12px; border-radius:9999px; border:1px solid rgba(255,255,255,.35); color:white; font-size:12px; opacity:.95}
    .ghost-btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:9999px; border:1px solid rgba(255,255,255,.4); color:white; background:transparent; cursor:pointer}
    .ghost-btn:active{transform:translateY(1px)}

    .card{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:18px; box-shadow:0 6px 30px rgb(2 8 23 / .06)}
    .card h2{margin:0 0 8px 0; font-size:16px; color:var(--sub); font-weight:600}

    form{display:grid; gap:14px}
    label{font-size:13px; color:var(--sub); margin-left:14px}
    .cap{
      appearance:none; width:100%; border:2px solid var(--line); border-radius:9999px; background:#fff;
      padding:14px 16px; font-size:16px; color:var(--ink); outline:none; transition:border-color .2s, box-shadow .2s;
    }
    .cap:focus{border-color:var(--brand); box-shadow:var(--ring)}
    .cap::placeholder{color:#94a3b8}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:600px){ .row{grid-template-columns:1fr} }

    select.cap{padding-right:42px; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%2399a3ad" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>'); background-repeat:no-repeat; background-position:right 14px center;}

    .file-wrap{display:flex; align-items:center; gap:10px}
    .file-input{display:none}
    .file-btn{display:inline-flex; align-items:center; gap:10px; border-radius:9999px; padding:12px 16px; background:linear-gradient(135deg, var(--brand), var(--brand2)); color:#fff; border:none; cursor:pointer}
    .file-name{font-size:13px; color:var(--sub)}

    .submit{margin-top:4px; display:flex; gap:10px}
    .btn{
      flex:1; border:none; cursor:pointer; padding:14px 18px; font-weight:700; font-size:16px; color:#fff;
      border-radius:9999px; background:linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow:0 8px 24px color-mix(in oklab, var(--brand) 40%, transparent);
    }
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .secondary{background:transparent; color:var(--brand); border:2px solid var(--brand)}

    .note{font-size:12px; color:var(--sub); margin-top:6px}

    .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); padding:12px 14px; border-radius:12px; color:#fff; font-weight:600; box-shadow:0 8px 30px rgb(2 8 23 /.28); display:none}
    .toast.ok{background:linear-gradient(135deg,#10b981,#059669)}
    .toast.err{background:linear-gradient(135deg,#ef4444,#dc2626)}

    .footer{margin:18px 0 40px 0; text-align:center; color:var(--sub); font-size:12px}
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <div class="title">
        <div class="app-icon" aria-hidden="true">
          <!-- simple S icon -->
          <svg viewBox="0 0 24 24" role="img" aria-label="SORA"><path d="M18.5 7.2c0 2.4-1.7 3.7-4.9 4.3l-1.5.3c-2.6.5-3.5 1.1-3.5 2.3 0 1.3 1.2 2.2 3.2 2.2 1.8 0 3.1-.6 3.4-1.8h3.2c-.3 3-2.9 4.9-6.5 4.9-3.9 0-6.6-2-6.6-5.1 0-2.8 1.8-4.3 5.4-5l1.7-.3c2.2-.4 2.9-.8 2.9-1.9 0-1.2-1.2-2-3-2-1.7 0-3 .7-3.4 1.8H5.1C5.5 3.5 8 1.8 12 1.8c3.7 0 6.5 2 6.5 5.4Z"/></svg>
        </div>
        <div>
          <h1>SORA</h1>
          <div class="sub">Sourcing Referral Agent</div>
        </div>
        <button id="themeBtn" class="ghost-btn" title="Ganti tema warna" type="button" style="margin-left:auto">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v2"/><path d="M12 19v2"/><path d="M3 12h2"/><path d="M19 12h2"/><path d="M5.6 5.6l1.4 1.4"/><path d="M17 17l1.4 1.4"/><path d="M17 7l1.4-1.4"/><path d="M5.6 18.4 7 17"/><circle cx="12" cy="12" r="4"/></svg>
          <span>Ganti warna</span>
        </button>
      </div>
      <div class="toolbar">
        <span class="chip">Mobile Ready</span>
        <span class="chip">Upload CV (PDF/DOC)</span>
        <span class="chip">Auto Timestamp</span>
      </div>
    </div>
  </header>

  <main class="wrap" style="margin-top:14px">
    <section class="card">
      <h2>Formulir Pengajuan</h2>
      <form id="soraForm" novalidate>
        <div>
          <label for="agent">Nama Agent</label>
          <input class="cap" id="agent" name="agent" type="text" placeholder="Nama agent" required autocomplete="name" />
        </div>

        <div>
          <label for="candidate">Nama Kandidat</label>
          <input class="cap" id="candidate" name="candidate" type="text" placeholder="Nama kandidat" required />
        </div>

        <div class="row">
          <div>
            <label for="education">Pendidikan Kandidat</label>
            <select class="cap" id="education" name="education" required>
              <option value="" disabled selected>Pilih pendidikan</option>
              <option>SMP</option>
              <option>SMA/SMK</option>
              <option>D1/D2/D3</option>
              <option>S1</option>
              <option>S2</option>
              <option>S3</option>
              <option>Lainnya</option>
            </select>
          </div>
          <div>
            <label for="phone">No. Handphone</label>
            <input class="cap" id="phone" name="phone" type="tel" inputmode="tel" pattern="[0-9+\s-]{8,}" placeholder="Contoh: 0812 3456 7890" required />
          </div>
        </div>

        <div>
          <label for="address">Alamat Kandidat</label>
          <input class="cap" id="address" name="address" type="text" placeholder="Alamat jalan, RT/RW, kelurahan" required />
        </div>

        <div>
          <label for="province">Provinsi</label>
          <select class="cap" id="province" name="province" required>
            <option value="" disabled selected>Pilih provinsi</option>
            <option>Aceh</option>
            <option>Sumatera Utara</option>
            <option>Sumatera Barat</option>
            <option>Riau</option>
            <option>Kepulauan Riau</option>
            <option>Jambi</option>
            <option>Sumatera Selatan</option>
            <option>Kepulauan Bangka Belitung</option>
            <option>Bengkulu</option>
            <option>Lampung</option>
            <option>DKI Jakarta</option>
            <option>Banten</option>
            <option>Jawa Barat</option>
            <option>Jawa Tengah</option>
            <option>DI Yogyakarta</option>
            <option>Jawa Timur</option>
            <option>Bali</option>
            <option>Nusa Tenggara Barat</option>
            <option>Nusa Tenggara Timur</option>
            <option>Kalimantan Barat</option>
            <option>Kalimantan Tengah</option>
            <option>Kalimantan Selatan</option>
            <option>Kalimantan Timur</option>
            <option>Kalimantan Utara</option>
            <option>Sulawesi Utara</option>
            <option>Gorontalo</option>
            <option>Sulawesi Tengah</option>
            <option>Sulawesi Barat</option>
            <option>Sulawesi Selatan</option>
            <option>Sulawesi Tenggara</option>
            <option>Maluku</option>
            <option>Maluku Utara</option>
            <option>Papua Barat</option>
            <option>Papua</option>
            <option>Papua Selatan</option>
            <option>Papua Tengah</option>
            <option>Papua Pegunungan</option>
            <option>Papua Barat Daya</option>
          </select>
        </div>

        <div>
          <label for="cv">Upload CV</label>
          <div class="file-wrap">
            <input id="cv" name="cv" class="file-input" type="file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" required />
            <button type="button" class="file-btn" id="cvBtn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Pilih atau Ambil CV
            </button>
            <span class="file-name" id="cvName">Belum ada file</span>
          </div>
          <div class="note">Format: PDF/DOC/DOCX/JPG/PNG • Maks ±10MB</div>
        </div>

        <div class="submit">
          <button id="submitBtn" class="btn" type="submit">Kirim</button>
          <button class="btn secondary" type="reset">Reset</button>
        </div>
        <div class="note">Dengan menekan Kirim, data akan tersimpan ke Sheet <b>responses</b> pada file Google Spreadsheet Anda.</div>
      </form>
    </section>

    <p class="footer">© <span id="year"></span> SORA — Sourcing Referral Agent</p>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // 1) ======= CONFIG ————
    // Ganti URL berikut dengan Web App URL dari Google Apps Script Anda (Deploy > New Deployment > Web App)
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwYjuTPLXBsvKi_dbHvxAhcCkVK0F-nfYh-BduaJFRqS1oHaJBolpLUIZdF1hd0Ouew/exec';

    // 2) ======= THEME ENGINE (warna dinamis) ————
    const THEMES = [
      {brand:'#2563eb', brand2:'#7c3aed', bg:'#f8fafc', card:'#ffffff', ink:'#0f172a', sub:'#475569', line:'#e2e8f0'}, // blue-violet
      {brand:'#16a34a', brand2:'#06b6d4', bg:'#f6fef9', card:'#ffffff', ink:'#052e16', sub:'#3f5d49', line:'#dbeafe'}, // green-cyan
      {brand:'#f97316', brand2:'#db2777', bg:'#fff7ed', card:'#ffffff', ink:'#431407', sub:'#a16207', line:'#ffe4e6'}, // orange-pink
      {brand:'#4f46e5', brand2:'#06b6d4', bg:'#eef2ff', card:'#ffffff', ink:'#0b1447', sub:'#4750a6', line:'#e2e8f0'}, // indigo-cyan
      {brand:'#10b981', brand2:'#22c55e', bg:'#f0fdf4', card:'#ffffff', ink:'#052e1a', sub:'#3f5d49', line:'#dcfce7'}, // emerald
      {brand:'#0ea5e9', brand2:'#7c3aed', bg:'#f0f9ff', card:'#ffffff', ink:'#0c4a6e', sub:'#3f5d7d', line:'#e0f2fe'}  // sky-purple
    ];

    function applyTheme(t){
      const r = document.documentElement;
      r.style.setProperty('--brand', t.brand);
      r.style.setProperty('--brand2', t.brand2);
      r.style.setProperty('--bg', t.bg);
      r.style.setProperty('--card', t.card);
      r.style.setProperty('--ink', t.ink);
      r.style.setProperty('--sub', t.sub);
      r.style.setProperty('--line', t.line);
      document.getElementById('themeColor').setAttribute('content', t.brand);
      // also refresh hero gradient inline style if needed (CSS uses vars so no need)
    }

    function loadTheme(){
      const saved = localStorage.getItem('sora_theme');
      if(saved){ try { applyTheme(JSON.parse(saved)); return; } catch(e){} }
      // Dynamic default: rotate by day so tampil beda tiap hari
      const idx = new Date().getDay() % THEMES.length; // 0-6
      applyTheme(THEMES[idx]);
    }

    function cycleTheme(){
      const current = localStorage.getItem('sora_theme');
      let idx = 0;
      if(current){
        const c = JSON.parse(current);
        idx = THEMES.findIndex(t => t.brand === c.brand && t.brand2 === c.brand2);
        idx = (idx + 1) % THEMES.length;
      } else {
        idx = (new Date().getDay() + 1) % THEMES.length;
      }
      const t = THEMES[idx];
      applyTheme(t);
      localStorage.setItem('sora_theme', JSON.stringify(t));
      toast('Tema diganti', true);
    }

    // 3) ======= UI HELPERS ————
    function toast(msg, ok){
      const el = document.getElementById('toast');
      el.className = 'toast ' + (ok ? 'ok' : 'err');
      el.textContent = msg;
      el.style.display = 'block';
      clearTimeout(el._t);
      el._t = setTimeout(()=>{ el.style.display='none'; }, 2400);
    }

    // 4) ======= FORM HANDLER ————
    const form = document.getElementById('soraForm');
    const submitBtn = document.getElementById('submitBtn');
    const cvEl = document.getElementById('cv');
    const cvBtn = document.getElementById('cvBtn');
    const cvName = document.getElementById('cvName');

    cvBtn.addEventListener('click', ()=> cvEl.click());
    cvEl.addEventListener('change', ()=>{
      cvName.textContent = cvEl.files?.[0]?.name || 'Belum ada file';
    });

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!SCRIPT_URL.includes('script.google.com')){
        toast('Konfigurasi belum diisi: SCRIPT_URL!', false);
        return;
      }
      if(!form.reportValidity()){ return; }

      const fd = new FormData(form);
      submitBtn.disabled = true;
      submitBtn.textContent = 'Mengirim…';

      try{
        // Using no-cors for broad compatibility with GAS
        await fetch(SCRIPT_URL, { method:'POST', body:fd, mode:'no-cors' });
        form.reset();
        cvName.textContent = 'Belum ada file';
        toast('Berhasil dikirim!', true);
      }catch(err){
        console.error(err);
        toast('Gagal mengirim. Coba lagi.', false);
      }finally{
        submitBtn.disabled = false;
        submitBtn.textContent = 'Kirim';
      }
    });

    // 5) ======= INIT ————
    document.getElementById('themeBtn').addEventListener('click', cycleTheme);
    document.getElementById('year').textContent = new Date().getFullYear();
    loadTheme();
  </script>

  <!--
  ──────────────────────────────────────────────────────────────────────────────
   BACKEND (Google Apps Script) — paste ke Apps Script (Kode.gs), deploy sbg Web App
  ──────────────────────────────────────────────────────────────────────────────

  1) Buka https://script.google.com/  → New project
  2) Ganti Kode.gs dengan script di bawah ini.
  3) Set spreadsheet target & folder upload (opsional) di konstanta.
  4) Deploy > New deployment > Web app > Who has access: Anyone.
  5) Copy URL hasil deployment, tempel ke const SCRIPT_URL di atas.

  // ====== KODE APPS SCRIPT (Kode.gs) ======

  const SHEET_ID = '1EDSpjVTBnmap52zpGQG-lSHLNerlJot6h0fHDZgu1NA'; // Spreadsheet dari user
  const SHEET_NAME = 'responses';
  const DRIVE_FOLDER_ID = null; // isi folder ID (string) jika ingin menyimpan file di folder tertentu, atau biarkan null untuk root Drive

  function doPost(e){
    try{
      const ss = SpreadsheetApp.openById(SHEET_ID);
      const sh = ss.getSheetByName(SHEET_NAME) || ss.insertSheet(SHEET_NAME);

      // Ambil field teks
      const agent     = e.parameter.agent || '';
      const candidate = e.parameter.candidate || '';
      const education = e.parameter.education || '';
      const address   = e.parameter.address || '';
      const province  = e.parameter.province || '';
      const phone     = e.parameter.phone || '';

      // Upload file (jika ada)
      let cvUrl = '';
      if (e.files && e.files.cv){
        const f = e.files.cv; // {length, name/filename, mimeType, bytes}
        // e.files.cv bisa array jika multi-file. Tangani keduanya.
        const files = Array.isArray(f) ? f : [f];
        const folder = DRIVE_FOLDER_ID ? DriveApp.getFolderById(DRIVE_FOLDER_ID) : DriveApp.getRootFolder();
        const uploaded = files.map(file => {
          const blob = Utilities.newBlob(file.bytes, file.mimeType, file.filename || file.name || 'cv');
          const g = folder.createFile(blob);
          g.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
          return g.getUrl();
        });
        cvUrl = uploaded.join(', ');
      }

      // Tulis ke sheet (tambahkan header jika kosong)
      if (sh.getLastRow() === 0){
        sh.appendRow(['Timestamp','Nama Agent','Nama Kandidat','Pendidikan','Alamat','Provinsi','No HP','CV URL']);
      }
      sh.appendRow([new Date(), agent, candidate, education, address, province, phone, cvUrl]);

      const out = ContentService.createTextOutput(JSON.stringify({ok:true}))
                    .setMimeType(ContentService.MimeType.JSON);
      return out;
    }catch(err){
      const out = ContentService.createTextOutput(JSON.stringify({ok:false, error:String(err)}))
                    .setMimeType(ContentService.MimeType.JSON);
      return out;
    }
  }

  // (Opsional) Izinkan preflight CORS jika Anda ingin gunakan fetch normal (tanpa no-cors)
  function doOptions() {
    return HtmlService.createHtmlOutput('')
      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)
      .setSandboxMode(HtmlService.SandboxMode.IFRAME);
  }

  // ====== END KODE APPS SCRIPT ======

  -->
</body>
</html>
